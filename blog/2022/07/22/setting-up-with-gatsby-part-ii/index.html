<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.18.2"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true"></title></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="sc-bczRLJ hUiJZk"><div class="sc-dkzDqf dFZSDP"><a href="/blog">Home</a></div><div class="sc-gsnTZi iDXRDz"><p>July 22, 2022</p><h1>Setting Up a Dev Blog with Gatsby in 2022, Part II: Deployment</h1><p>Today we will deploying the new Gatsby-based dev blog that we just finished setting up.</p><br/><h2>1. What We Want: Automatic Builds</h2><hr/><p>The main thing we want is some kind of setup where merging changes to our git repository runs our build process and rebuilds our static assets. After a very brief period of reflection we have decided to deploy our blog using Github Pages. Given there are no secrets in our project, the repository can be public.</p><h2>2. Create a repo on Github</h2><hr/><p>A new, empty repository was created on Github at <!-- --><a href="https://github.com/jonkers3/dev-blog">https://github.com/jonkers3/dev-blog</a>.<!-- --></p><h2>3. Setup our git remote</h2><hr/><p>First, we just need to commit our initial changes:</p><pre class="prism-code language-sh" style="color:#393A34;background-color:#f6f8fa;padding:20px;position:relative"><button style="position:absolute;top:0;right:0;margin:8px;padding:8px 12px 8px 12px;border-radius:8px;border-width:0;background:deepskyblue">Copy</button><div class="token-line" style="color:#393A34"><span class="token plain">git commit -a -m &#x27;Initial Commit&#x27;</span></div></pre><p>Now, add a git remote pointing to our Github repository.</p><pre class="prism-code language-sh" style="color:#393A34;background-color:#f6f8fa;padding:20px;position:relative"><button style="position:absolute;top:0;right:0;margin:8px;padding:8px 12px 8px 12px;border-radius:8px;border-width:0;background:deepskyblue">Copy</button><div class="token-line" style="color:#393A34"><span class="token plain">git remote add origin git@github.com:jonkers3/dev-blog.git</span></div></pre><h2>4. Setup SSH for Github</h2><hr/><p>Create an SSH key</p><pre class="prism-code language-sh" style="color:#393A34;background-color:#f6f8fa;padding:20px;position:relative"><button style="position:absolute;top:0;right:0;margin:8px;padding:8px 12px 8px 12px;border-radius:8px;border-width:0;background:deepskyblue">Copy</button><div class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen -t ed25519 -C &#x27;me@myemail.com&#x27;</span></div></pre><p>Add it to your SSH agent:</p><pre class="prism-code language-sh" style="color:#393A34;background-color:#f6f8fa;padding:20px;position:relative"><button style="position:absolute;top:0;right:0;margin:8px;padding:8px 12px 8px 12px;border-radius:8px;border-width:0;background:deepskyblue">Copy</button><div class="token-line" style="color:#393A34"><span class="token plain">eval &quot;$(ssh-agent -s)&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">ssh-add ~/.ssh/id_ed25519</span></div></pre><p>Copy the public key to your clipboard:</p><pre class="prism-code language-sh" style="color:#393A34;background-color:#f6f8fa;padding:20px;position:relative"><button style="position:absolute;top:0;right:0;margin:8px;padding:8px 12px 8px 12px;border-radius:8px;border-width:0;background:deepskyblue">Copy</button><div class="token-line" style="color:#393A34"><span class="token plain">cat ~/.ssh/id_ed25519.pub</span></div></pre><p>Add the SSH key to your Github account <!-- --><a href="github.com/settings/ssh/new">Add SSH Key</a></p><p>We should now be able to authenticate with Github via SSH. This can be verified by running the following command:</p><pre class="prism-code language-sh" style="color:#393A34;background-color:#f6f8fa;padding:20px;position:relative"><button style="position:absolute;top:0;right:0;margin:8px;padding:8px 12px 8px 12px;border-radius:8px;border-width:0;background:deepskyblue">Copy</button><div class="token-line" style="color:#393A34"><span class="token plain">ssh -T git@github.com</span></div></pre><p>The final step to push our code to Github is this:</p><pre class="prism-code language-sh" style="color:#393A34;background-color:#f6f8fa;padding:20px;position:relative"><button style="position:absolute;top:0;right:0;margin:8px;padding:8px 12px 8px 12px;border-radius:8px;border-width:0;background:deepskyblue">Copy</button><div class="token-line" style="color:#393A34"><span class="token plain">git push --set-upstream origin master</span></div></pre><p>For the time being, we can just commit directly to the master branch. Certainly there are many other ways we could be using git, but for the moment, this actually suits our needs quite well.</p><p>We commit our changes, call <!-- --><code>git push</code>, and all of our changes are pushed to Github instantly.<!-- --></p><p>And that is where things are at now: our files are live in our Github repository.</p><h2>5. Setup Github Pages</h2><hr/><p>Let&#x27;s give Github actions a try. <!-- --><a href="https://github.com/marketplace/actions/github-pages-action">This</a> appears to be intended to make it very easy for us to deploy a Gatsby site to Github Pages.<!-- --></p><p>Create the following file:</p><h4><code>.github/workflows/gh-pages.js</code></h4><pre class="prism-code language-yml" style="color:#393A34;background-color:#f6f8fa;padding:20px;position:relative"><button style="position:absolute;top:0;right:0;margin:8px;padding:8px 12px 8px 12px;border-radius:8px;border-width:0;background:deepskyblue">Copy</button><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GitHub Pages</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> master</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pull_request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">20.04</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">permissions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">contents</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> write</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">concurrency</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">group</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> github.workflow </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> github.ref </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v3</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Setup Node</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node@v3</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">node-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;18&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Cache dependencies</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/cache@v2</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ~/.npm</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> runner.os </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> hashFiles(&#x27;</span><span class="token important">**/package-lock.json&#x27;)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">restore-keys</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></div><div class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            ${{ runner.os }}-node-</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> npm ci</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> npm run build</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deploy</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> peaceiris/actions</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gh</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pages@v3</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> github.ref == &#x27;refs/heads/master&#x27; </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">github_token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.GITHUB_TOKEN </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">publish_dir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./public</span></div></pre></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2022/07/22/setting-up-with-gatsby-part-ii/";window.___webpackCompilationHash="1276a7e469c42606c594";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-c45296d263f73f755e88.js"],"app":["/app-80bf3ffbbd83861d505f.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-5eaf6ba0adaef0785a30.js"],"component---src-pages-blog-index-js":["/component---src-pages-blog-index-js-579f9402e0e676dd5261.js"],"component---src-pages-blog-mdx-slug-js":["/component---src-pages-blog-mdx-slug-js-f133ae67f7dd17e9e028.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-d85ddae18426042658ca.js"]};/*]]>*/</script><script src="/polyfill-c45296d263f73f755e88.js" nomodule=""></script><script src="/app-80bf3ffbbd83861d505f.js" async=""></script><script src="/framework-ff1a361479b969340c84.js" async=""></script><script src="/webpack-runtime-b92df8593e66f56a0c65.js" async=""></script></body></html>