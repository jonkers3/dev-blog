---
title: Deploying a Gatsby Dev Blog on Github Pages
date: 2022-07-22
---

# Deploying Our New Dev Blog

Today we will deploying the new Gatsby-based dev blog that we worked through setting up [here](/2022/07/20/setting-up-with-gatsby/).

<br/>

## 1. We Want Easy Deployment
---

Initially, we will just deploy to Github Pages. For today, the main concern is just getting something up there that we can easily add content and deploy changes to. So we will now head over to Github and do just that.

<br/>

## 2. Setup a repository on Github
---

Create yourself a new, empty repository on [Github](https://github.com/new).

The Gatsby CLI should have initialized a git repository for us at the very beginning. Setting up SSH access to Github will things much easier:

### Create an SSH key (with your own email)
```sh
ssh-keygen -t ed25519 -C 'me@my-email.com'

eval "$(ssh-agent -s)"

ssh-add ~/.ssh/id_ed25519
```

Copy the output of `cat ~/.ssh/id_ed25519.pub` to the clipboard, paste it [here](https://github.com/settings/ssh/new) and save it, then verify things are working by running:
```sh
ssh -T git@github.com
```

### Add a remote and push our code to Github.
```sh
git remote add origin git@github.com:jonkers3/dev-blog.git

git push --set-upstream origin master
```

At this point we should have our code live on Github in our _master_ branch.

Now, we can just commit our changes and `git push`, and our code with go straight to the master branch on Github.

<br/>

## 3. Setup Github Pages
---

Gatsby is not the default for Github Pages, but it can still work. [Github Pages Action](https://github.com/marketplace/actions/github-pages-action) is just the sort of thing we are looking for, and the only thing we need to do to leverage it is create a yml file. This is a slightly modified version of the example they give for Gatsby:

#### `.github/workflows/gh-pages.yml`
```yml
name: GitHub Pages

on:
  push:
    branches:
      - master
  pull_request:

jobs:
  deploy:
    runs-on: ubuntu-20.04
    permissions:
      contents: write
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Cache dependencies
        uses: actions/cache@v2
        with:
          path: ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      - run: npm ci
      - run: npm run build

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        if: ${{ github.ref == 'refs/heads/master' }}
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
```

On the settings page for your Github repository, make sure that branch is set to `gh-pages` and that selected folder is `root`; it should look like this:

![](github-pages-settings.png)

Once those things are setup correctly, that should be it. Pushing changes to Github (`git push`) will trigger the workflow, and the process will culminate in the new version of our site being deployed to Github Pages.

<br/>

## 4. Update gatsby-config to fix images
---

Due to the nature of our Github Pages setup, we need to make the following change to ensure that all of our images and links are working right. The value for our pathPrefix is, of course, the name of the Github repository. Add the pathPrefix to your config:

#### *`gatsby-config.ts`*
```javascript
  pathPrefix: 'dev-blog',
```

At this point, the extra `blog` in our URL is redundant, so let's get rid of it. We can just move the files in the `src/pages/blog` folder into `src/pages`.

#### *`src/pages/index.js`*
```sh
mv src/pages/blog/index.js src/pages/index.js
mv src/pages/blog/{mdx.slug}.js src/pages/{mdx.slug}.js
```

This effectively just makes our blog the index page of our site, and our URL is cleaner.

<br/>

## 6. Commit changes and push to Github
---

```sh
git commit -a -u -m 'initial deploy' && git push
```

At this point, your blog should be looking good on Github Pages. For now, we're up here: [https://jonkers3.github.io/dev-blog](https://jonkers3.github.io/dev-blog).