{"componentChunkName":"component---src-pages-mdx-slug-js","path":"/2022/07/22/setting-up-with-gatsby-ii/","result":{"data":{"mdx":{"frontmatter":{"title":"Deploying a Gatsby Dev Blog on Github Pages","date":"July 22, 2022"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Deploying a Gatsby Dev Blog on Github Pages\",\n  \"date\": \"2022-07-22T00:00:00.000Z\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", null, \"Deploying Our New Dev Blog\"), mdx(\"p\", null, \"Today we will deploying the new Gatsby-based dev blog that we worked through setting up \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/dev-blog/2022/07/20/setting-up-with-gatsby/\"\n  }, \"here\"), \".\"), mdx(\"br\", null), mdx(\"h2\", null, \"1. We Want Automated Builds and Easy Deployment\"), mdx(\"hr\", null), mdx(\"p\", null, \"For the time being, I'm just going to deploy to Github Pages. I will hook up a custom domain later. My main concern at the moment is just being able to add content and deploy changes to the site as effortlessly as possible. So now we go to Github.\"), mdx(\"br\", null), mdx(\"h2\", null, \"2. Setup a repository on Github\"), mdx(\"hr\", null), mdx(\"p\", null, \"Create yourself a new, empty repository on Github. We made ours \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/jonkers3/dev-blog\"\n  }, \"here\"), \".\"), mdx(\"p\", null, \"The Gatsby CLI initialized a git repository for us at the very beginning of this. We need to commit our changes eventually, but first we should setup SSH access to Github. This will make everything much easier down the road.\"), mdx(\"h3\", null, \"Create an SSH key (use your own email)\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"ssh-keygen -t ed25519 -C 'me@my-email.com'\\n\\neval \\\"$(ssh-agent -s)\\\"\\n\\nssh-add ~/.ssh/id_ed25519\\n\")), mdx(\"p\", null, \"Copy the output of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cat ~/.ssh/id_ed25519.pub\"), \" to the clipboard, paste it \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/settings/ssh/new\"\n  }, \"here\"), \". Give it a name and save it, then verify that it is working by running \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ssh -T git@github.com\"), \".\"), mdx(\"h3\", null, \"Add a remote and push our code to Github.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"git remote add origin git@github.com:jonkers3/dev-blog.git\\n\\ngit push --set-upstream origin master\\n\")), mdx(\"p\", null, \"Now we can just commit changes and call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"git push\"), \" to have them pushed right to the master branch on Github.\"), mdx(\"p\", null, \"At this point we should have our code live on Github in the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"master\"), \" branch. Let's see what it takes to get it deployed as an actual website.\"), mdx(\"br\", null), mdx(\"h2\", null, \"3. Setup Github Pages\"), mdx(\"hr\", null), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/marketplace/actions/github-pages-action\"\n  }, \"This template\"), \" appears to be just the sort of things we are looking for: an easy way to deploy our static site to Github Pages. The provided example for Gatsby appears to get us pretty close to what we need. Create the following file:\"), mdx(\"h4\", null, mdx(\"inlineCode\", {\n    parentName: \"h4\"\n  }, \".github/workflows/gh-pages.js\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yml\"\n  }, \"name: GitHub Pages\\n\\non:\\n  push:\\n    branches:\\n      - master\\n  pull_request:\\n\\njobs:\\n  deploy:\\n    runs-on: ubuntu-20.04\\n    permissions:\\n      contents: write\\n    concurrency:\\n      group: ${{ github.workflow }}-${{ github.ref }}\\n    steps:\\n      - uses: actions/checkout@v3\\n\\n      - name: Setup Node\\n        uses: actions/setup-node@v3\\n        with:\\n          node-version: '18'\\n\\n      - name: Cache dependencies\\n        uses: actions/cache@v2\\n        with:\\n          path: ~/.npm\\n          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}\\n          restore-keys: |\\n            ${{ runner.os }}-node-\\n\\n      - run: npm ci\\n      - run: npm run build\\n\\n      - name: Deploy\\n        uses: peaceiris/actions-gh-pages@v3\\n        if: ${{ github.ref == 'refs/heads/master' }}\\n        with:\\n          github_token: ${{ secrets.GITHUB_TOKEN }}\\n          publish_dir: ./public\\n\")), mdx(\"p\", null, \"Commit this new file and merge it into the master branch. Goto the Settings page for the Github repository, and make sure Branch is set to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gh-pages\"), \" and the selected folder is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"root\"), \", as in the following picture:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"900px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/dev-blog/static/0af42f574786412bdaa27fcd1f5af9df/bb3b7/github-pages-settings.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"38.666666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABPUlEQVQY0z2RWW7DMAxEfYBY1mItJLXLlhMnTgr0/ncr3LQB5mMI8gEccrCYmbAfoS8xdx9XJuxlMiM3l0lfuLm8zb/ewwNQ5RI+sPUbxD3k7ig7TA4z+OIwO8zom6MCvmJoYoaR26GuO8VFqJOfpJtTjPdrPfb165GOIz6e+fmKxzPcd+wF1oI9Yy+2RRVooLCEsmkXR24m6RTRHEgSKu8FkqTwp7N0EkES/nZJAg4+rVITk+69dl3upe2pXMG3XK8xdgoLULWQtKtCF8btyO04WcbtsGzHyM0nM6V1u3/fHt8+9/X2ldsOoRnI0xkKmIRzmGsmTuSELeYPn+q1314YmnZRu6BdMpgtnneyp8kWsnKN68iEGfrtCb4aTIaSMn6SjiuQmsSMEBefNzCkNPEZhQKukCucFLLfB/0ArCwwKqehz2AAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"github pages settings\",\n    \"title\": \"github pages settings\",\n    \"src\": \"/dev-blog/static/0af42f574786412bdaa27fcd1f5af9df/1cfc2/github-pages-settings.png\",\n    \"srcSet\": [\"/dev-blog/static/0af42f574786412bdaa27fcd1f5af9df/3684f/github-pages-settings.png 225w\", \"/dev-blog/static/0af42f574786412bdaa27fcd1f5af9df/fc2a6/github-pages-settings.png 450w\", \"/dev-blog/static/0af42f574786412bdaa27fcd1f5af9df/1cfc2/github-pages-settings.png 900w\", \"/dev-blog/static/0af42f574786412bdaa27fcd1f5af9df/bb3b7/github-pages-settings.png 1211w\"],\n    \"sizes\": \"(max-width: 900px) 100vw, 900px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Now, every time we push changes to our master branch on Github, this action will be triggered to run our build process, and ultimately to deploy a new version of our website.\"), mdx(\"br\", null), mdx(\"h2\", null, \"4. Tweak path settings\"), mdx(\"hr\", null), mdx(\"p\", null, \"Due to the nature of our Github Pages setup, we need to make the following change, which should be fairly self-explanatory:\"), mdx(\"h4\", null, mdx(\"em\", {\n    parentName: \"h4\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"gatsby-config.ts\"))), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"\\n+ pathPrefix: 'dev-blog', // https://jonkers3.github.io/dev-blog <---\\n\\n  siteMetadata: ...\\n\")), mdx(\"p\", null, \"Given that at the moment all we really have is a blog, the extra \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"blog\"), \" in our URL is a big redundant, especially coming after the dev-blog that we're already in!\"), mdx(\"p\", null, \"Let's clean that up. It turns out that the easiest way to fix this right now is just to move the blog index and template files out of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"src/pages/blog\"), \" folder and into \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"src/pages\"), \".\"), mdx(\"h4\", null, mdx(\"em\", {\n    parentName: \"h4\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"src/pages/index.js\"))), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"mv src/pages/blog/index.js src/pages/index.js\\nmv src/pages/blog/{mdx.slug}.js src/pages/{mdx.slug}.js\\n\")), mdx(\"p\", null, \"Fix the imports in these two files to reflect the change:\"), mdx(\"h4\", null, mdx(\"em\", {\n    parentName: \"h4\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"src/pages/{mdx.slug}.js\"))), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-jsx\"\n  }, \"- import Code from '../../components/Code'\\n- import Layout from '../../components/Layout'\\n\\n+ import Code from '../components/Code'\\n+ import Layout from '../components/Layout'\\n\")), mdx(\"h4\", null, mdx(\"em\", {\n    parentName: \"h4\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"src/pages/index.js\"))), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-jsx\"\n  }, \"- import Layout from '../../components/Layout'\\n+ import Layout from '../components/Layout'\\n\")), mdx(\"br\", null), mdx(\"h2\", null, \"5. Create a gatsby-node.js config file\"), mdx(\"hr\", null), mdx(\"p\", null, \"The last thing we need to do is create some helpers for generating our static files. This is used during the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby build\"), \" task. Create the following file:\"), mdx(\"h4\", null, mdx(\"em\", {\n    parentName: \"h4\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"gatsby-node.js\"))), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"const path = require(`path`)\\n\\nexports.createPages = ({ graphql, actions }) => {\\n  const { createPage } = actions\\n  return graphql(`\\n    {\\n      allMdx(sort: { order: DESC, fields: [frontmatter___date] }, limit: 1000) {\\n        nodes {\\n          frontmatter {\\n            date(formatString: \\\"DD MMMM YYYY\\\")\\n            title\\n          }\\n          slug\\n        }\\n      }\\n    }\\n  `).then((result) => {\\n    const posts = result.data.allMdx.nodes\\n\\n    posts.forEach((node, index) => {\\n      createPage({\\n        path: node.slug,\\n        component: path.resolve(`./src/pages/{mdx.slug}.js`),\\n        context: {\\n          slug: node.slug,\\n          prev: index === 0 ? undefined : posts[index - 1],\\n          next: index === posts.length - 1 ? undefined : posts[index + 1],\\n        }\\n      })\\n    })\\n  })\\n}\\n\")), mdx(\"br\", null), mdx(\"h2\", null, \"6. Commit changes and push to Github\"), mdx(\"hr\", null), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"git commit -a -u -m 'initial deploy' && git push\\n\")), mdx(\"p\", null, \"Now we more or less just need to push code, and not worry about deployment. At this point, our blog should be looking good on Github Pages. For now, ours is here: \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://jonkers3.github.io/dev-blog\"\n  }, \"https://jonkers3.github.io/dev-blog\"), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"cb097b2f-aa22-56cc-afbb-2e6eb2630f2f","slug":"2022/07/22/setting-up-with-gatsby-ii/","__params":{"slug":"2022"}}},"staticQueryHashes":[]}