{"componentChunkName":"component---src-pages-mdx-slug-js","path":"/2022/07/22/setting-up-with-gatsby-ii/","result":{"data":{"mdx":{"frontmatter":{"title":"Deploying a Gatsby Dev Blog on Github Pages","date":"July 22, 2022","tags":["Gatsby","CI"]},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Deploying a Gatsby Dev Blog on Github Pages\",\n  \"date\": \"2022-07-22T00:00:00.000Z\",\n  \"tags\": [\"Gatsby\", \"CI\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", null, \"Deploying Our New Gatsby Dev Blog\"), mdx(\"p\", null, \"Today we will deploying the new Gatsby-based dev blog that we worked through setting up \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/dev-blog/2022/07/20/setting-up-with-gatsby/\"\n  }, \"here\"), \".\"), mdx(\"p\", null, \"Today, we will just deploy to Github Pages, mostly just because it is free and probably easy to set up.\"), mdx(\"p\", null, \"Our main goal at the moment is just to get something up that we can easily add content and deploy changes to.\"), mdx(\"br\", null), mdx(\"h2\", null, \"1. Setup Github Repo and SSH\"), mdx(\"hr\", null), mdx(\"p\", null, \"Create yourself a new, empty repository on \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/new\"\n  }, \"Github\"), \". Locally, the Gatsby CLI should already have initialized a git repository for us. If not, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"git init\"), \".\"), mdx(\"h3\", null, \"Create an SSH key (with your own email)\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\",\n    \"metastring\": \"command=1,3,5 noCopy=2-5\",\n    \"command\": \"1,3,5\",\n    \"noCopy\": \"2-5\"\n  }, \"ssh-keygen -t ed25519 -C 'your@own-email.com'\\n\\neval \\\"$(ssh-agent -s)\\\"\\n\\nssh-add ~/.ssh/id_ed25519\\n\")), mdx(\"p\", null, \"Copy the output of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cat ~/.ssh/id_ed25519.pub\"), \" to the clipboard, paste it \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/settings/ssh/new\"\n  }, \"here\"), \" and save it, then verify things are working by running:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"ssh -T git@github.com\\n\")), mdx(\"h3\", null, \"Add a remote and push our code to Github.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\",\n    \"metastring\": \"command=1,3\",\n    \"command\": \"1,3\"\n  }, \"git remote add origin git@github.com:jonkers3/dev-blog.git\\n\\ngit push --set-upstream origin master\\n\")), mdx(\"p\", null, \"At this point we should have our code live on Github in our \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"master\"), \" branch.\"), mdx(\"p\", null, \"Now, we can just commit our changes and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"git push\"), \", and our code with go straight to the master branch on Github.\"), mdx(\"br\", null), mdx(\"h2\", null, \"2. Configure Github Pages\"), mdx(\"hr\", null), mdx(\"p\", null, \"On the settings page for your Github repository, make sure that branch is set to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gh-pages\"), \" and that selected folder is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"root\"), \", like this:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"900px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/dev-blog/static/0af42f574786412bdaa27fcd1f5af9df/bb3b7/github-pages-settings.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"38.666666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABPUlEQVQY0z2RWW7DMAxEfYBY1mItJLXLlhMnTgr0/ncr3LQB5mMI8gEccrCYmbAfoS8xdx9XJuxlMiM3l0lfuLm8zb/ewwNQ5RI+sPUbxD3k7ig7TA4z+OIwO8zom6MCvmJoYoaR26GuO8VFqJOfpJtTjPdrPfb165GOIz6e+fmKxzPcd+wF1oI9Yy+2RRVooLCEsmkXR24m6RTRHEgSKu8FkqTwp7N0EkES/nZJAg4+rVITk+69dl3upe2pXMG3XK8xdgoLULWQtKtCF8btyO04WcbtsGzHyM0nM6V1u3/fHt8+9/X2ldsOoRnI0xkKmIRzmGsmTuSELeYPn+q1314YmnZRu6BdMpgtnneyp8kWsnKN68iEGfrtCb4aTIaSMn6SjiuQmsSMEBefNzCkNPEZhQKukCucFLLfB/0ArCwwKqehz2AAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"github pages settings\",\n    \"title\": \"github pages settings\",\n    \"src\": \"/dev-blog/static/0af42f574786412bdaa27fcd1f5af9df/1cfc2/github-pages-settings.png\",\n    \"srcSet\": [\"/dev-blog/static/0af42f574786412bdaa27fcd1f5af9df/3684f/github-pages-settings.png 225w\", \"/dev-blog/static/0af42f574786412bdaa27fcd1f5af9df/fc2a6/github-pages-settings.png 450w\", \"/dev-blog/static/0af42f574786412bdaa27fcd1f5af9df/1cfc2/github-pages-settings.png 900w\", \"/dev-blog/static/0af42f574786412bdaa27fcd1f5af9df/bb3b7/github-pages-settings.png 1211w\"],\n    \"sizes\": \"(max-width: 900px) 100vw, 900px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Gatsby is not the default for Github Pages, but it can still work, and \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/marketplace/actions/github-pages-action\"\n  }, \"Github Pages Action\"), \" looks like just the sort of thing that might make this easy. The only thing we need to do to leverage it is create the following yml file, which is a slightly modified version of the Gatsby example provided in their docs:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yml\",\n    \"metastring\": \"file=.github/workflows/gh-pages.yml\",\n    \"file\": \".github/workflows/gh-pages.yml\"\n  }, \"name: GitHub Pages\\n\\non:\\n  push:\\n    branches:\\n      - master\\n  pull_request:\\n\\njobs:\\n  deploy:\\n    runs-on: ubuntu-20.04\\n    permissions:\\n      contents: write\\n    concurrency:\\n      group: ${{ github.workflow }}-${{ github.ref }}\\n    steps:\\n      - uses: actions/checkout@v3\\n\\n      - name: Setup Node\\n        uses: actions/setup-node@v3\\n        with:\\n          node-version: '18'\\n\\n      - name: Cache dependencies\\n        uses: actions/cache@v2\\n        with:\\n          path: ~/.npm\\n          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}\\n          restore-keys: |\\n            ${{ runner.os }}-node-\\n\\n      - run: npm ci\\n      - run: npm run build\\n\\n      - name: Deploy\\n        uses: peaceiris/actions-gh-pages@v3\\n        if: ${{ github.ref == 'refs/heads/master' }}\\n        with:\\n          github_token: ${{ secrets.GITHUB_TOKEN }}\\n          publish_dir: ./public\\n\")), mdx(\"p\", null, \"Once those things are setup correctly, that should be it. When the master branch is updated on Github (as in when you call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"git push\"), \"), it will trigger the workflow, and the process will culminate in a new version of our site being deployed to Github Pages.\"), mdx(\"br\", null), mdx(\"h2\", null, \"3. Update gatsby-config with path prefix\"), mdx(\"hr\", null), mdx(\"p\", null, \"Due to the nature of our Github Pages setup which entails our site root located in a subfolder, we need to make the one more change to ensure that all of our images and links are working right in the pages Gatsby generates.\"), mdx(\"p\", null, \"The value for our pathPrefix is, of course, the name of the Github repository. We don't need the path prefix in our development environment, so we can control whether it is set but using environment variable:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-json\",\n    \"metastring\": \"file=package.json add=2 remove=4 exclude=1,5\",\n    \"file\": \"package.json\",\n    \"add\": \"2\",\n    \"remove\": \"4\",\n    \"exclude\": \"1,5\"\n  }, \"\\\"scripts\\\": {\\n  \\\"build\\\": \\\"PATH_PREFIX=/dev-blog gatsby build --prefix-paths\\\",\\n\\n  \\\"build\\\": \\\"gatsby build\\\",\\n},\\n\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\",\n    \"metastring\": \"file=gatsby-config.ts\",\n    \"file\": \"gatsby-config.ts\"\n  }, \"  pathPrefix: process.env.PATH_PREFIX,\\n\")), mdx(\"br\", null), mdx(\"h2\", null, \"4. Commit changes and push to Github\"), mdx(\"hr\", null), mdx(\"p\", null, \"It turns out to be as easy as that. Push the rest of your changes and things should be good to go.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"git add -A && git commit -a -m 'initial deploy' && git push\\n\")), mdx(\"p\", null, \"At this point, the blog should be looking good on Github Pages. Have fun with your new Gatsby blog!\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"cb097b2f-aa22-56cc-afbb-2e6eb2630f2f","slug":"2022/07/22/setting-up-with-gatsby-ii/","__params":{"slug":"2022"}}},"staticQueryHashes":[]}